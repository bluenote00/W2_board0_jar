<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.W2_board0_jar.dao.board.BoardDao">
    <!-- 게시판 전체 조회-->
    <select id="SelectBoardList" parameterType="java.util.Map" resultType="com.example.W2_board0_jar.dto.board.BoardDto">
        SELECT * FROM (
                SELECT inner_table.*, ROWNUM AS rn FROM (
                SELECT
                BOARD_TYPE AS boardType,
                CASE BOARD_TYPE
                WHEN 'a01' THEN '일반'
                WHEN 'a02' THEN 'Q&amp;A'
                WHEN 'a03' THEN '익명'
                WHEN 'a04' THEN '자유'
                ELSE '기타'
                END AS boardTypeName,
                BOARD_NUM AS boardNum,
                BOARD_TITLE AS boardTitle,
                BOARD_COMMENT AS boardComment
        FROM BOARD
        <if test="boardType != null and boardType != ''">
            WHERE BOARD_TYPE = #{boardType}
        </if>
        ORDER BY BOARD_NUM DESC
            ) inner_table
            WHERE ROWNUM &lt;= #{pageIndex} + #{pageSize}
            )
        WHERE rn &gt; #{pageIndex}
    </select>

    <!-- 게시글 갯수 카운트-->
    <select id="SelectBoardCount" parameterType="java.util.Map">
        /* com.example.W2_board0_jar.dao.board.BoardDao */
        SELECT      COUNT(*)
        FROM        BOARD
        <if test="boardType !=null and boardType!=''">
        WHERE           BOARD_TYPE = #{boardType}
        </if>
    </select>


    <!-- 게시글 상세보기 -->
    <select id="SelectBoardDetail" parameterType="java.util.Map" resultType ="com.example.W2_board0_jar.dto.board.BoardDto">
        /* com.example.W2_board0_jar.dao.board.BoardDao */
        SELECT            BOARD_TYPE       AS boardType
                 ,        CASE BOARD_TYPE
                          WHEN 'a01' THEN '일반'
                          WHEN 'a02' THEN 'Q&amp;A'
                          WHEN 'a03' THEN '익명'
                          WHEN 'a04' THEN '자유'
                          ELSE '기타'
                    END             AS  boardTypeName
             ,		BOARD_NUM       AS  boardNum
             ,		BOARD_TITLE     AS  boardTitle
             ,    	BOARD_COMMENT   AS  boardComment
             ,    	FILE_NAME       AS  fileName
             ,    	CREATOR 		AS  creator
        FROM 		BOARD
        WHERE       BOARD_NUM       =   #{boardNum}
    </select>

    <select id="selectBoardNextList" parameterType="java.util.Map" resultType="java.util.Map">
                SELECT *
                FROM (
                         SELECT     BOARD_NUM,
                                    LEAD(BOARD_NUM) OVER (ORDER BY BOARD_NUM) AS NEXT_NUM,
                                    LAG(BOARD_NUM) OVER (ORDER BY BOARD_NUM) AS PREV_NUM,
                                        BOARD_TITLE,
                                    LEAD(BOARD_TITLE) OVER (ORDER BY BOARD_NUM) AS NEXT_TITLE,
                                    LAG(BOARD_TITLE) OVER (ORDER BY BOARD_NUM) AS PREV_TITLE
                         FROM       BOARD
                     ) TEMP
                WHERE               BOARD_NUM = #{boardNum}
    </select>

    <!-- 게시글 작성 -->
    <insert id="BoardWrite" parameterType="map">
        /* com.example.W2_board0_jar.dao.board.BoardDao */
        <selectKey keyProperty="boardNum" resultType="int" order="BEFORE">
            SELECT NVL(MAX(BOARD_NUM), 0) + 1 AS boardNum FROM BOARD
        </selectKey>
        INSERT INTO 	BOARD
        (
                        BOARD_NUM
                ,       BOARD_TYPE
                ,		BOARD_TITLE
                ,		BOARD_COMMENT
                ,		FILE_NAME
                ,		FILE_ROOT
                ,		CREATOR
                ,       CREATE_TIME
        ) VALUES (
                        #{boardNum}
                 ,      #{boardType}
                 ,		#{boardTitle}
                 ,		#{boardComment}
                 ,		#{fileName}
                 ,		#{fileRoot}
                 ,		#{userId}
                 ,		SYSDATE
                 )
    </insert>

    <!-- 게시글 수정 -->
    <update id="UpdateBoard" parameterType="map">
        UPDATE 		BOARD
        SET
                    BOARD_TYPE      =   #{boardType}
          ,         BOARD_TITLE	    = 	#{boardTitle}
          ,	        BOARD_COMMENT 	= 	#{boardComment}
          ,	        MODIFIER 		= 	#{userId}
          ,  	    MODIFIED_TIME 	=   SYSDATE
        WHERE 		BOARD_NUM       =   #{boardNum}
    </update>

    <!-- 게시글 삭제 -->
    <delete id="BoardDelete" parameterType="map">
        DELETE
        FROM        BOARD
        WHERE 		BOARD_NUM       =   #{boardNum}
    </delete>
</mapper>